define ("core/local/reactive/reactive",["exports","core/log","core/local/reactive/statemanager","core/pending"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=e(b);c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function g(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var g=a.apply(b,c);function h(a){f(g,d,e,h,i,"next",a)}function i(a){f(g,d,e,h,i,"throw",a)}h(void 0)})}}function h(a,b){return n(a)||m(a,b)||k(a,b)||j()}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function m(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null==c)return;var d=[],e=!0,f=!1,g,h;try{for(c=c.call(a);!(e=(g=c.next()).done);e=!0){d.push(g.value);if(b&&d.length===b)break}}catch(a){f=!0;h=a}finally{try{if(!e&&null!=c["return"])c["return"]()}finally{if(f)throw h}}return d}function n(a){if(Array.isArray(a))return a}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function p(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function q(a,b,c){if(b)p(a.prototype,b);if(c)p(a,c);Object.defineProperty(a,"prototype",{writable:!1});return a}var r=0,s=function(){function a(b){var e,f;o(this,a);if(b.eventName===void 0||b.eventDispatch===void 0){throw new Error("Reactivity event required")}if(b.name!==void 0){this.name=b.name}this.target=null!==(e=b.target)&&void 0!==e?e:document.createTextNode(null);this.eventName=b.eventName;this.eventDispatch=b.eventDispatch;this.stateManager=new c.default(this.eventDispatch,this.target);this.watchers=new Map([]);this.components=new Set([]);this.mutations=null!==(f=b.mutations)&&void 0!==f?f:{};this.target.addEventListener(this.eventName,this.callWatchersHandler.bind(this));this.pendingState=new d.default("core/reactive:registerInstance".concat(r++));if(b.state!==void 0){this.setInitialState(b.state)}if(M.reactive!==void 0){M.reactive.registerNewInstance(this)}}q(a,[{key:"callWatchersHandler",value:function callWatchersHandler(a){this.target.dispatchEvent(new CustomEvent(a.detail.action,{bubbles:!1,detail:a.detail}))}},{key:"setInitialState",value:function setInitialState(a){this.pendingState.resolve();this.stateManager.setInitialState(a)}},{key:"addMutations",value:function addMutations(a){if(a.init!==void 0){a.init(this.stateManager)}for(var b=0,c=Object.entries(a);b<c.length;b++){var d=h(c[b],2),e=d[0],f=d[1];this.mutations[e]=f.bind(a)}}},{key:"setMutations",value:function setMutations(a){this.mutations=a;if(a.init!==void 0){a.init(this.stateManager)}}},{key:"state",get:function get(){return this.stateManager.state}},{key:"get",value:function get(a,b){return this.stateManager.get(a,b)}},{key:"getInitialStatePromise",value:function getInitialStatePromise(){return this.stateManager.getInitialPromise()}},{key:"registerComponent",value:function registerComponent(a){var c,e=this,f=null!==(c=a.name)&&void 0!==c?c:"Unkown component",g=function(){},h=g;if(a.dispatchRegistrationSuccess!==void 0){g=a.dispatchRegistrationSuccess.bind(a)}if(a.dispatchRegistrationFail!==void 0){h=a.dispatchRegistrationFail.bind(a)}if(this.components.has(a)){g();return a}var i=new d.default("core/reactive:registerComponent".concat(r++)),j=[],k=[];if(a.getWatchers!==void 0){k=a.getWatchers()}k.forEach(function(b){var c=b.watch,d=b.handler;if(c===void 0){h();throw new Error("Missing watch attribute in ".concat(f," watcher"))}if(d===void 0){h();throw new Error("Missing handler for watcher ".concat(c," in ").concat(f))}var g=function(b){var c=document.activeElement;d.apply(a,[b.detail]);if(document.activeElement===document.body&&document.body.contains(c)){c.focus()}};j.push({target:e.target,watch:c,listener:g});e.target.addEventListener(c,g)});if(a.stateReady!==void 0){this.getInitialStatePromise().then(function(b){a.stateReady(b);i.resolve();return!0}).catch(function(a){i.resolve();b.default.error("Initial state in ".concat(f," rejected due to: ").concat(a));b.default.error(a)})}this.watchers.set(a,j);this.components.add(a);this.target.dispatchEvent(new CustomEvent("registerComponent:success",{bubbles:!1,detail:{component:a}}));g();return a}},{key:"unregisterComponent",value:function unregisterComponent(a){if(!this.components.has(a)){return a}this.components.delete(a);var b=this.watchers.get(a);if(b===void 0){return a}b.forEach(function(a){var b=a.target,c=a.watch,d=a.listener;b.removeEventListener(c,d)});this.watchers.delete(a);return a}},{key:"dispatch",value:function(){var a=g(regeneratorRuntime.mark(function b(a){var c,e,f,g,h,i=arguments;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:if(!("string"!=typeof a)){b.next=2;break}throw new Error("Dispatch action name must be a string");case 2:if(!("_"===a.charAt(0))){b.next=4;break}throw new Error("Illegal Private ".concat(a," mutation method dispatch"));case 4:if(!(this.mutations[a]===void 0)){b.next=6;break}throw new Error("Unkown ".concat(a," mutation"));case 6:c=new d.default("core/reactive:".concat(a).concat(r++));e=this.mutations[a];b.prev=8;for(f=i.length,g=Array(1<f?f-1:0),h=1;h<f;h++){g[h-1]=i[h]}b.next=12;return e.apply(this.mutations,[this.stateManager].concat(g));case 12:c.resolve();b.next=20;break;case 15:b.prev=15;b.t0=b["catch"](8);this.stateManager.setReadOnly(!0);c.resolve();throw b.t0;case 20:case"end":return b.stop();}}},b,this,[[8,15]])}));return function dispatch(){return a.apply(this,arguments)}}()}]);return a}();a.default=s;return a.default});
//# sourceMappingURL=reactive.min.js.map
