function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}f(void 0)})}}define ("core_form/ajaxform",["jquery","core/ajax","core/notification","core/templates","core/event","core/str","core/yui","core/fragment"],function(a,b,c,d,f,g,h,e){var i=function(a,b){this.formClass=b;this.container=a;this.init()};i.prototype.container=null;i.prototype.formClass="";i.prototype.init=_asyncToGenerator(regeneratorRuntime.mark(function b(){var d,e;return regeneratorRuntime.wrap(function(b){while(1){switch(b.prev=b.next){case 0:e="";if("object"===_typeof(this.container)){d=a(this.container)}else{d=a("body");e=this.container+" "}b.next=4;return g.get_strings([{key:"collapseall",component:"moodle"},{key:"expandall",component:"moodle"}]).catch(c.exception);case 4:d.on("click",e+"form input[type=submit][data-cancel]",this.cancelButtonPressed.bind(this));d.on("click",e+"form input[type=submit][data-no-submit]",this.noSubmitButtonPressed.bind(this));d.on("submit",e+"form",this.submitFormAjax.bind(this));case 7:case"end":return b.stop();}}},b,this)}));i.prototype.getContainer=function(b){if("object"===_typeof(this.container)){return a(this.container)}else{return a(b).closest(this.container)}};i.prototype.load=function(b){var c=a(this.container);return this.getBody(a.param(b)).then(function(a,b){this.updateForm(c,a,b)}.bind(this))};i.prototype.getBody=function(c){var d=a.Deferred();b.call([{methodname:"core_form_modal",args:{formdata:c,form:this.formClass}}])[0].then(function(a){d.resolve(a.html,e.processCollectedJavascript(a.javascript));return null}).fail(function(a){d.reject(a)});return d.promise()};i.prototype.onSubmitSuccess=function(a,b){b.html("");return a};i.prototype.onValidationError=function(){};i.prototype.onCancel=function(a){a.html("")};i.prototype.onSubmitError=function(a){c.exception(a)};i.prototype.noSubmitButtonPressed=function(b){b.preventDefault();var d=this.getContainer(b.currentTarget);f.notifyFormSubmitAjax(d.find("form")[0],!0);var e=d.find("form").serialize(),g=a(b.currentTarget);e=e+"&"+encodeURIComponent(g.attr("name"))+"="+encodeURIComponent(g.attr("value"));this.disableButtons(d);this.getBody(e).then(function(a,b){this.updateForm(d,a,b)}.bind(this)).fail(c.exception)};i.prototype.cancelButtonPressed=function(a){a.preventDefault();var b=this.getContainer(a.currentTarget);f.notifyFormSubmitAjax(b.find("form")[0],!0);h.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});this.onCancel(b)};i.prototype.updateForm=function(a,b,c){d.replaceNodeContents(a,b,c)};i.prototype.validateElements=function(b){f.notifyFormSubmitAjax(b.find("form")[0]);var c=a.merge(b.find("[aria-invalid=\"true\"]"),b.find(".error"));if(c.length){c.first().focus();return!1}return!0};i.prototype.disableButtons=function(a){a.find("form input[type=\"submit\"]").attr("disabled",!0)};i.prototype.enableButtons=function(a){a.find("form input[type=\"submit\"]").removeAttr("disabled")};i.prototype.submitFormAjax=function(a){a.preventDefault();var c=this.getContainer(a.currentTarget);if(!this.validateElements(c)){return}this.disableButtons(c);var d=c.find("form").serialize();b.call([{methodname:"core_form_modal",args:{formdata:d,form:this.formClass}}])[0].then(function(a){if(!a.submitted){this.updateForm(c,a.html,e.processCollectedJavascript(a.javascript));this.enableButtons(c);this.onValidationError()}else{h.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()});var b=JSON.parse(a.data);this.enableButtons(c);this.onSubmitSuccess(b,c)}return null}.bind(this)).fail(this.onSubmitError.bind(this))};return i});
//# sourceMappingURL=ajaxform.min.js.map
