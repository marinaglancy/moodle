define(["jquery","core/fragment","core/ajax","core/notification","core/templates","core/event","core/yui"],function(a,b,c,d,e,f,g){var h=function(b,c,d){this.formClass=c,this.container=b,this.getBody(a.param(d)).then(this.updateForm.bind(this)),this.init()};return h.prototype.container=null,h.prototype.formClass="",h.prototype.init=function(){this.container.on("click","form input[type=submit][data-cancel]",this.cancelButtonPressed.bind(this)),this.container.on("click","form input[type=submit][data-no-submit]",this.noSubmitButtonPressed.bind(this)),this.container.on("submit","form",this.submitFormAjax.bind(this))},h.prototype.getBody=function(d){var e=a.Deferred();return c.call([{methodname:"core_form_modal",args:{formdata:d,form:this.formClass}}])[0].then(function(a){return e.resolve(a.html,b.processCollectedJavascript(a.javascript)),null}).fail(function(a){e.reject(a)}),e},h.prototype.onSubmitSuccess=function(a){return this.container.html(""),a},h.prototype.onValidationError=function(){},h.prototype.onCancel=function(){this.container.html("")},h.prototype.onSubmitError=function(a){d.exception(a)},h.prototype.noSubmitButtonPressed=function(b){b.preventDefault(),"undefined"!=typeof window.tinyMCE&&window.tinyMCE.triggerSave();var c=this.container.find("form").serialize(),d=a(b.currentTarget);c=c+"&"+encodeURIComponent(d.attr("name"))+"="+encodeURIComponent(d.attr("value")),this.getBody(c).then(this.updateForm.bind(this))},h.prototype.cancelButtonPressed=function(a){a.preventDefault(),f.notifyFormSubmitAjax(this.container.find("form")[0]),g.use("moodle-core-formchangechecker",function(){M.core_formchangechecker.reset_form_dirty_state()}),this.onCancel()},h.prototype.updateForm=function(a,b){this.container.html(a),b&&e.runTemplateJS(b)},h.prototype.validateElements=function(){var b=document.createEvent("HTMLEvents");b.initEvent("change",!0,!0),this.container.find(":input").each(function(a,c){c.dispatchEvent(b)});var c=a.merge(this.container.find('[aria-invalid="true"]'),this.container.find(".error"));return!c.length||(c.first().focus(),!1)},h.prototype.submitFormAjax=function(a){if(a.preventDefault(),"undefined"!=typeof window.tinyMCE&&window.tinyMCE.triggerSave(),this.validateElements()){f.notifyFormSubmitAjax(this.container.find("form")[0]);var d=this.container.find("form").serialize();c.call([{methodname:"core_form_modal",args:{formdata:d,form:this.formClass}}])[0].then(function(a){if(a.submitted){var c=JSON.parse(a.data);this.onSubmitSuccess(c)}else this.updateForm(a.html,b.processCollectedJavascript(a.javascript)),this.onValidationError()}.bind(this)).fail(this.onSubmitError.bind(this))}},h});