{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template mod_feedback/analysis

    Displays analysis of one item

    Classes required for JS:
    * none

    Data attributes required for JS:
    * none

    Context variables required for this template:
    * none

    Example context (json):
    {
        "hasdata" : 1,
        "itemtype" : "text",
        "itemnr" : 2,
        "haslabel" : 1,
        "label" : "itemlabel",
        "name" : "How did you like this course?",
        "individualdata" : [ "It was ok", "Amazing", "I've seen better" ],
        "summary" : "<p>Some <b>additional</b> statistics goes here...</p>"
    }

}}

{{#hasdata}}
<div class="analysis itemtype_{{itemtype}}" id="item_analysis_{{itemid}}">
    <div class="questionshort" aria-expanded="true">
        {{>mod_feedback/itemshortname}}
        <a href="#" data-showquestion="full" role="button">{{#str}} more, mod_feedback {{/str}}</a>
    </div>
    <div class="questionfull" style="display:none" aria-expanded="false">
        {{>mod_feedback/itemfullname}}
        <a href="#" data-showquestion="short" role="button">{{#str}} less, mod_feedback {{/str}}</a>
    </div>
    <div class="details">
        {{#individualdata.0}}
            <ul class="individualdata">
            {{#individualdata}}
                <li>{{{.}}}</li>
            {{/individualdata}}
            </ul>
        {{/individualdata.0}}
        {{#summary}}
            <div class="summary">
                {{{summary}}}
            </div>
        {{/summary}}
    </div>
</div>
{{/hasdata}}

{{#js}}
    require(['jquery'], function($) {
        $('body').delegate('.analysis a[data-showquestion=full]', 'click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            var main = $(this).closest('.analysis');
            main.find('.questionshort').hide().attr('aria-expanded','false');
            main.find('.questionfull').show().attr('aria-expanded','true');
            main.find('.questionfull a[data-showquestion=short]').focus();
        });
        $('body').delegate('.analysis a[data-showquestion=short]', 'click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            var main = $(this).closest('.analysis');
            main.find('.questionshort').show().attr('aria-expanded','true');
            main.find('.questionfull').hide().attr('aria-expanded','false');
            main.find('.questionshort a[data-showquestion=full]').focus();
        });
    });
{{/js}}
